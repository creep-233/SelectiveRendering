// 不要包含 Common.usf / SceneTexture... ―― 插件 usf 先写成纯 HLSL 资源访问

RWTexture2D<float4> OutTex;
Texture2D LowTex;
SamplerState LowTexSampler;
Texture2D HighTex;
SamplerState HighTexSampler;
Texture2D SalTex;
SamplerState SalTexSampler;

int2 OutputSize;
float Threshold;
float Boost;

[numthreads(8, 8, 1)]
void MainCS(uint3 DTid : SV_DispatchThreadID)
{
    if (DTid.x >= OutputSize.x || DTid.y >= OutputSize.y)
        return;

    float2 uv = (DTid.xy + 0.5) / OutputSize;

    float3 lo = LowTex.SampleLevel(LowTexSampler, uv, 0).rgb;
    float3 hi = HighTex.SampleLevel(HighTexSampler, uv, 0).rgb;
    float s = SalTex.SampleLevel(SalTexSampler, uv, 0).r;

    s = saturate(pow(max(s, 0.0), max(Boost, 1e-3)));
    float3 c = lerp(lo, hi, step(Threshold, s));

    OutTex[DTid.xy] = float4(c, 1.0);
}
